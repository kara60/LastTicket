@model TicketSystem.Application.Common.Models.PaginatedList<TicketSystem.Application.Features.Tickets.DTOs.TicketListDto>
@{
    ViewData["Title"] = "Ticket'larım";
}

<!-- Stats Overview -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
    @{
        var totalTickets = Model.TotalCount;
        var pendingTickets = Model.Items.Count(t => t.StatusDisplay == "İnceleniyor");
        var inProgressTickets = Model.Items.Count(t => t.StatusDisplay == "İşlemde");
        var resolvedTickets = Model.Items.Count(t => t.StatusDisplay == "Çözüldü");
    }

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center">
            <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mr-4">
                <i class="fas fa-ticket-alt text-blue-600 text-xl"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">Toplam</p>
                <p class="text-2xl font-bold text-gray-900">@totalTickets</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center">
            <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center mr-4">
                <i class="fas fa-clock text-yellow-600 text-xl"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">İnceleniyor</p>
                <p class="text-2xl font-bold text-yellow-600">@pendingTickets</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center">
            <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center mr-4">
                <i class="fas fa-cog text-indigo-600 text-xl"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">İşlemde</p>
                <p class="text-2xl font-bold text-indigo-600">@inProgressTickets</p>
            </div>
        </div>
    </div>

    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
        <div class="flex items-center">
            <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mr-4">
                <i class="fas fa-check-circle text-green-600 text-xl"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">Çözüldü</p>
                <p class="text-2xl font-bold text-green-600">@resolvedTickets</p>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Filters -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 mb-6">
    <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-900">Filtreler</h3>
            <button id="toggleFilters" class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                <i class="fas fa-chevron-down mr-1"></i>
                Gelişmiş Filtreler
            </button>
        </div>
    </div>

    <form method="get" id="filterForm" class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
            <!-- Quick Search -->
            <div class="lg:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Hızlı Arama</label>
                <div class="relative">
                    <input type="text" name="SearchTerm" value="@Context.Request.Query["SearchTerm"]"
                           placeholder="Ticket numarası, başlık veya açıklama..."
                           class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                </div>
            </div>

            <!-- Status Filter -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Durum</label>
                <select name="Status" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="">Tüm Durumlar</option>
                    <option value="İnceleniyor" @(Context.Request.Query["Status"] == "İnceleniyor" ? "selected" : "")>
                        İnceleniyor
                    </option>
                    <option value="İşlemde" @(Context.Request.Query["Status"] == "İşlemde" ? "selected" : "")>
                        İşlemde
                    </option>
                    <option value="Çözüldü" @(Context.Request.Query["Status"] == "Çözüldü" ? "selected" : "")>
                        Çözüldü
                    </option>
                    <option value="Kapandı" @(Context.Request.Query["Status"] == "Kapandı" ? "selected" : "")>
                        Kapandı
                    </option>
                </select>
            </div>

            <!-- Sort By -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Sıralama</label>
                <select name="SortBy" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="newest">En Yeni</option>
                    <option value="oldest">En Eski</option>
                    <option value="status">Duruma Göre</option>
                    <option value="priority">Önceliğe Göre</option>
                </select>
            </div>
        </div>

        <!-- Advanced Filters (Hidden by default) -->
        <div id="advancedFilters" class="hidden border-t border-gray-200 pt-4 mt-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tarih Aralığı</label>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="date" name="StartDate" value="@Context.Request.Query["StartDate"]"
                               class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <input type="date" name="EndDate" value="@Context.Request.Query["EndDate"]"
                               class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ticket Türü</label>
                    <select name="TypeId" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Tüm Türler</option>
                        <!-- Bu kısım dinamik olarak doldurulacak -->
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Sayfa Boyutu</label>
                    <select name="PageSize" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="10" @(Context.Request.Query["PageSize"] == "10" ? "selected" : "")>10</option>
                        <option value="25" @(Context.Request.Query["PageSize"] == "25" ? "selected" : "")>25</option>
                        <option value="50" @(Context.Request.Query["PageSize"] == "50" ? "selected" : "")>50</option>
                        <option value="100" @(Context.Request.Query["PageSize"] == "100" ? "selected" : "")>100</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Filter Actions -->
        <div class="flex items-center justify-between pt-4">
            <div class="flex items-center space-x-3">
                <button type="submit" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-colors font-medium">
                    <i class="fas fa-search mr-2"></i>
                    Filtrele
                </button>
                <button type="button" onclick="clearFilters()" class="inline-flex items-center px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors">
                    <i class="fas fa-times mr-2"></i>
                    Temizle
                </button>
            </div>

            <div class="text-sm text-gray-600">
                <i class="fas fa-info-circle mr-1"></i>
                @Model.TotalCount sonuçtan @Model.Items.Count() gösteriliyor
            </div>
        </div>
    </form>
</div>

<!-- Tickets List -->
@if (Model.Items.Any())
{
    <div class="space-y-4">
        @foreach (var ticket in Model.Items)
        {
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200 overflow-hidden">
                <div class="p-6">
                    <div class="flex items-start justify-between">
                        <!-- Ticket Info -->
                        <div class="flex-1">
                            <!-- Header -->
                            <div class="flex items-center mb-3">
                                <div class="w-3 h-3 rounded-full mr-3" style="background-color: @ticket.TypeColor"></div>
                                <span class="text-sm font-medium text-gray-600">#@ticket.TicketNumber</span>
                                <span class="mx-2 text-gray-300">•</span>
                                <span class="text-sm text-gray-500">@ticket.CreatedAt.ToString("dd.MM.yyyy HH:mm")</span>

                                <!-- Status Badge -->
                                <div class="ml-4">
                                    <span class="inline-flex items-center px-3 py-1 text-xs font-semibold rounded-full
                                                @(ticket.StatusDisplay == "İnceleniyor" ? "bg-yellow-100 text-yellow-800" :
                                                                                    ticket.StatusDisplay == "İşlemde" ? "bg-blue-100 text-blue-800" :
                                                                                    ticket.StatusDisplay == "Çözüldü" ? "bg-green-100 text-green-800" :
                                                                                    "bg-gray-100 text-gray-800")">
                                @switch (ticket.StatusDisplay)
                                        {
                                            case "İnceleniyor":
                                                <i class="fas fa-clock mr-1"></i>
                                                break;
                                            case "İşlemde":
                                                <i class="fas fa-cog mr-1"></i>
                                                break;
                                            case "Çözüldü":
                                                <i class="fas fa-check mr-1"></i>
                                                break;
                                            default:
                                                <i class="fas fa-times mr-1"></i>
                                                break;
                                        }
                                        @ticket.StatusDisplay
                                    </span>
                                </div>
                            </div>

                            <!-- Title -->
                            <h3 class="text-xl font-bold text-gray-900 mb-2 line-clamp-2">@ticket.Title</h3>

                            <!-- Meta Info -->
                            <div class="flex items-center text-sm text-gray-500 mb-4">
                                <span class="flex items-center mr-6">
                                    <i class="fas fa-tag mr-2"></i>
                                    @ticket.TypeName
                                </span>
                                <span class="flex items-center mr-6">
                                    <i class="fas fa-folder mr-2"></i>
                                    @ticket.CategoryName
                                </span>
                                @if (ticket.CommentCount > 0)
                                {
                                    <span class="flex items-center">
                                        <i class="fas fa-comments mr-2"></i>
                                        @ticket.CommentCount yorum
                                    </span>
                                }
                            </div>

                            <!-- Progress Bar (if in progress) -->
                            @if (ticket.StatusDisplay == "İşlemde")
                            {
                                <div class="mb-4">
                                    <div class="flex items-center justify-between text-xs text-gray-600 mb-1">
                                        <span>İşleniyor</span>
                                        <span>%60</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: 60%"></div>
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- Action Button -->
                        <div class="ml-6">
                            <a href="@Url.Action("Details", new { id = ticket.Id })"
                               class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-gray-50 to-gray-100 hover:from-gray-100 hover:to-gray-200 text-gray-700 rounded-xl transition-all duration-200 font-medium border border-gray-200 hover:border-gray-300 group">
                                <span>Detaylar</span>
                                <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform duration-200"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Enhanced Pagination -->
    @if (Model.TotalPages > 1)
    {
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 mt-6 p-6">
            <div class="flex items-center justify-between">
                <div class="text-sm text-gray-600">
                    <span class="font-medium">@((Model.PageNumber - 1) * Model.PageSize + 1)</span>
                    -
                    <span class="font-medium">@(Math.Min(Model.PageNumber * Model.PageSize, Model.TotalCount))</span>
                    arası, toplam
                    <span class="font-medium">@Model.TotalCount</span>
                    kayıt
                </div>

                <div class="flex items-center space-x-2">
                    @if (Model.HasPreviousPage)
                    {
                        <a href="?Page=1&@(Context.Request.QueryString.Value?.TrimStart('?'))"
                           class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            <i class="fas fa-angle-double-left"></i>
                        </a>
                        <a href="?Page=@(Model.PageNumber - 1)&@(Context.Request.QueryString.Value?.Replace($"Page={Model.PageNumber}", "").TrimStart('?').TrimStart('&'))"
                           class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            <i class="fas fa-angle-left"></i>
                        </a>
                    }

                    @for (int i = Math.Max(1, Model.PageNumber - 2); i <= Math.Min(Model.TotalPages, Model.PageNumber + 2); i++)
                    {
                        <a href="?Page=@i&@(Context.Request.QueryString.Value?.Replace($"Page={Model.PageNumber}", "").TrimStart('?').TrimStart('&'))"
                           class="px-4 py-2 text-sm font-medium rounded-lg transition-colors @(i == Model.PageNumber ? "bg-blue-600 text-white" : "bg-white text-gray-700 hover:bg-gray-50 border border-gray-300")">
                            @i
                        </a>
                    }

                    @if (Model.HasNextPage)
                    {
                        <a href="?Page=@(Model.PageNumber + 1)&@(Context.Request.QueryString.Value?.Replace($"Page={Model.PageNumber}", "").TrimStart('?').TrimStart('&'))"
                           class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            <i class="fas fa-angle-right"></i>
                        </a>
                        <a href="?Page=@Model.TotalPages&@(Context.Request.QueryString.Value?.Replace($"Page={Model.PageNumber}", "").TrimStart('?').TrimStart('&'))"
                           class="px-3 py-2 text-sm bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                            <i class="fas fa-angle-double-right"></i>
                        </a>
                    }
                </div>
            </div>
        </div>
    }
}
else
{
    <!-- Empty State -->
    <div class="text-center py-16">
        <div class="w-32 h-32 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-ticket-alt text-blue-400 text-4xl"></i>
        </div>
        <h3 class="text-2xl font-semibold text-gray-900 mb-3">Henüz Ticket Yok</h3>
        <p class="text-gray-600 mb-6 max-w-md mx-auto">
            Henüz hiç destek talebi oluşturmamışsınız. İlk ticket'ınızı oluşturarak başlayın.
        </p>
        <a href="@Url.Action("Create")"
           class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 shadow-lg hover:shadow-xl font-semibold text-lg">
            <i class="fas fa-plus mr-3"></i>
            İlk Ticket'ınızı Oluşturun
        </a>
    </div>
}

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle advanced filters
            const toggleBtn = document.getElementById('toggleFilters');
            const advancedFilters = document.getElementById('advancedFilters');

            if (toggleBtn && advancedFilters) {
                toggleBtn.addEventListener('click', function() {
                    const isHidden = advancedFilters.classList.contains('hidden');

                    if (isHidden) {
                        advancedFilters.classList.remove('hidden');
                        toggleBtn.innerHTML = '<i class="fas fa-chevron-up mr-1"></i>Gelişmiş Filtreler';
                    } else {
                        advancedFilters.classList.add('hidden');
                        toggleBtn.innerHTML = '<i class="fas fa-chevron-down mr-1"></i>Gelişmiş Filtreler';
                    }
                });
            }

            // Auto-submit form on filter change
            const filterSelects = document.querySelectorAll('#filterForm select');
            filterSelects.forEach(select => {
                select.addEventListener('change', function() {
                    // Optional: Auto-submit on select change
                    // document.getElementById('filterForm').submit();
                });
            });
        });

        function clearFilters() {
            const form = document.getElementById('filterForm');
            const inputs = form.querySelectorAll('input, select');

            inputs.forEach(input => {
                if (input.type === 'text' || input.type === 'date') {
                    input.value = '';
                } else if (input.type === 'select-one') {
                    input.selectedIndex = 0;
                }
            });

            // Submit cleared form
            form.submit();
        }
    </script>
}